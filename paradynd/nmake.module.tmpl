# 
# Common makefile template for paradynd.  This file is not intended to
# be a useful Makefile in isolation; instead, it should be included
# from within an architecture-specific Makefile.
#
# $Id: nmake.module.tmpl,v 1.55 2005/12/19 19:42:42 pack Exp $
#

TARGET	      = paradynd.exe

#SRCS	     = $(SRCS) ../src/ast.C \
#		../src/comm.C \
#		../src/context.C \
#		../src/debugger.C \
#		../src/dynrpc.C \
#		../src/init.C \
#		../src/inst.C \
#		../src/main.C \
#		../src/metricFocusNode.C \
#               ../src/machineMetFocusNode.C \
#               ../src/processMetFocusNode.C \
#               ../src/threadMetFocusNode.C \
#               ../src/instrCodeNode.C \
#               ../src/instrDataNode.C \
#               ../src/instReqNode.C \
#		../src/internalMetrics.C \
#		../src/costmetrics.C \
#		../src/metricDefs-critPath.C \
#		../src/perfStream-def.C \
#		../src/perfStream.C \
#		../src/process.C \
#      ../../dyninstAPI/src/bitArray.C \
#               ../src/installed_miniTramps_list.C \
#		../src/resource.C \
#		../src/stats.C \
#		../src/symtab.C \
#		../src/function.C \
#		../src/util.C \
# 		../src/mdl.C \
# 		../src/focus.C \
#		../src/processMgr.C \
#               ../src/pd_process.C \
#		../src/threadMgr.C \
#		../src/pd_thread.C \
#		../src/templates0.C \
#		../src/templates05.C \
#		../src/templates1.C \
#		../src/templatesIGEN.C


!ifdef USES_SHM_SAMPLING
SRCS 		= $(SRCS) \
		   ../src/varInstanceHKs.C \
		   ../src/varInstance.C \
		   ../src/shmMgr.C \
		   ../src/variableMgr.C \
		   ../src/shmSegment-win.C \
		   ../src/shmSegment.C \
		   ../src/sharedMetaData.C
		#		   ../src/varTable.C \

CXXFLAGS	= $(CXXFLAGS) -DSHM_SAMPLING
TFLAGS		= $(TFLAGS) -DSHM_SAMPLING
CFLAGS		= $(CFLAGS) -DSHM_SAMPLING
!endif

CXXFLAGS	= $(CXXFLAGS) -DNEW_TIME_TYPES
TFLAGS		= $(TFLAGS) -DNEW_TIME_TYPES
CFLAGS		= $(CFLAGS) -DNEW_TIME_TYPES

IGEN_GEN_SRCS = dyninstRPC.mrnet.SRVR.C 

IGEN_ISRCS    = dyninstRPC.I

IFLAGS          = $(IFLAGS) -I..\..\dyninstAPI\h  -I../../mrnet/mrnet/h/ -I../../mrnet -I../../mrnet/mrnet/src/

OBJS      = $(OBJS) ast.obj \
		CodeView.obj \
		comm.obj \
		context.obj \
		dynrpc.obj \
		init.obj \
                arch.obj \
      dominator.obj \
		inst.obj \
		instPoint.obj \
		main.obj \
		metricFocusNode.obj \
                machineMetFocusNode.obj \
                processMetFocusNode.obj \
               threadMetFocusNode.obj \
                instrCodeNode.obj \
                instrDataNode.obj \
                instReqNode.obj \
		internalMetrics.obj \
		costmetrics.obj \
		metricDefs-critPath.obj \
      api_showerror.obj \
      BPatch.obj \
      BPatch_type.obj \
      BPatch_thread.obj \
      BPatch_process.obj \
      BPatch_snippet.obj \
      BPatch_function.obj \
      BPatch_point.obj \
      BPatch_image.obj \
      BPatch_module.obj \
      BPatch_collections.obj \
      BPatch_edge.obj \
      BPatch_loopTreeNode.obj \
        BPatch_frame.obj \
		BPatch_sourceBlock.obj \
		BPatch_basicBlock.obj \
		BPatch_basicBlockLoop.obj \
		BPatch_flowGraph.obj \
		BPatch_eventLock.obj \
		BPatch_asyncEventHandler.obj \
		Object.obj \
		MemoryAccess.obj \
		BPatch_instruction.obj \
		dyn_thread.obj \
		perfStream-def.obj \
		resource.obj \
		stats.obj \
		symtab.obj \
		function.obj \
		image-func.obj \
		variable.obj \
		InstrucIter-xplat.obj \
		multiTramp.obj \
		baseTramp.obj \
		miniTramp.obj \
		mapped_object.obj \
		mapped_module.obj \
		util.obj \
 		mdl.obj \
 		mdld_data.obj \
 		focus.obj \
		showerror.obj \
		perfStream.obj \
		process.obj \
    bitArray.obj \
 		frame.obj \
		dyn_lwp.obj \
		signalhandler.obj \
		rpcMgr.obj \
		rpcMgr-thr.obj \
		rpcMgr-lwp.obj \
		reloc-func.obj \
      bitArray.obj \
		LineInformation.obj \
		processMgr.obj \
                pd_process.obj \
		threadMgr.obj \
		pd_thread.obj \
		pd_image.obj \
		pd_module.obj \
		dyninstRPC.mrnet.SRVR.obj \
		BPatch_templates.obj \
		templatesIGEN.obj \
                templatesPD-nt.obj \
		templates-nt.obj \
		codeRange.obj 

!ifdef USES_SHM_SAMPLING
OBJS	= $(OBJS) \
		varInstanceHKs.obj \
		varInstance.obj \
		shmMgr.obj \
#		varTable.obj \
		variableMgr.obj \
		shmSegment-win.obj \
		shmSegment.obj \
		sharedMetaData.obj
!endif

LIBS		= $(LIBS) libpdutil.lib libmrnet.lib libxplat.lib

SYSLIBS		= $(SYSLIBS) oncrpc.lib ws2_32.lib dbghelp.lib shlwapi.lib

all:    $(IGEN_GEN_SRCS) $(TARGET)

$(TARGET):	$(IGEN_GEN_SRCS)

dyninstRPC.mrnet.SRVR.C: ..\..\paradyn\h\dyninstRPC.I
	igen -mrnet ..\..\paradyn\h\dyninstRPC.I

{..\..\paradyn\h\}.I.C:
	igen -mrnet ..\..\paradyn\h\dyninstRPC.I

{..\..\paradyn\h\}.I.h:
	igen -mrnet ..\..\paradyn\h\dyninstRPC.I

{..\..\dyninstAPI\src\}.C.obj:
	$(CXX) $(CXXFLAGS) -c $<

