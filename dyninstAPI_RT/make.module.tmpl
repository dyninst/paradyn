#
# Common makefile template for rtinst library.  This file is not
# intended to be a useful Makefile in isolation; instead, it should be
# included from within an architecture-specific Makefile.
# $Id: make.module.tmpl,v 1.10 2000/07/28 20:51:53 hollings Exp $
#

SUITE_NAME	= Dyninst
RELEASE_NUM	= 2.2beta
#BUILD_MARK should be (re-)defined in core/make.config.local rather than here!

ifndef TARGET
TARGET	      = libdyninstAPI_RT.o
endif

MODCC         = $(CC)
MODCFLAGS     = $(CFLAGS)

SRCS         += ../src/RTcommon.c

ifdef USES_SHM_SAMPLING
CFLAGS	+= -DSHM_SAMPLING
endif

ifdef USES_LIBDYNINSTRT_SO
TARGET3_SO=libdyninstAPI_RT.so.1
all: $(TARGET3_SO)
else
all: $(TARGET) $(TARGET2) $(ALT_TARGET)
endif

OBJS =		$(patsubst %.C, %.o, $(filter %.C,$(notdir $(SRCS)))) \
		$(patsubst %.c, %.o, $(filter %.c,$(notdir $(SRCS)))) \
		$(patsubst %.s, %.o, $(filter %.s,$(notdir $(SRCS)))) \
		$(patsubst %.S, %.o, $(filter %.S,$(notdir $(SRCS)))) \
		$(IGEN_GEN_SRCS:%.C=%.o)

ifndef USES_LIBDYNINSTRT_SO
#
# override standard link rule; libdyninst is not really a library or a program.
#
UNCOMMON_LINK=true
$(TARGET): $(OBJS)
	@$(MAKE) $(VOUCHER)
	$(LD) $(LDFLAGS) -o $(TARGET) $(VOUCHER).o $(OBJS) $(LIBS) -lgcc

ifndef DEST
DEST		= $(TO_CORE)/$(LIBRARY_DEST)
endif

UNCOMMON_INSTALL=true
install: $(DEST)/$(TARGET) $(SYSEXTRAS)

$(DEST)/$(TARGET):  $(TARGET)
	-$(CP) $(TARGET) $(DEST)

endif #USES_LIBDYNINSTRT_SO
