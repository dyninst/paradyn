#/***********************************************************************
# * Copyright © 2003 Dorian C. Arnold, Philip C. Roth, Barton P. Miller *
# *                  Detailed MRNet usage rights in "LICENSE" file.     *
# **********************************************************************/
# $Id: Makefile.in,v 1.1 2003/11/14 19:17:22 pcroth Exp $
@SET_MAKE@

RANLIB  = @RANLIB@

prefix  = @prefix@
exec_prefix=@exec_prefix@
srcdir  = @srcdir@
libdir  = @libdir@
includedir  = @includedir@

VPATH   = $(srcdir)/src

CXX = @CXX@
INSTALL = @INSTALL@


TARGET = libxplat.a
INCFLAGS = -I$(srcdir)/include -I$(srcdir)/.. -I.
CXXFLAGS = @CXXFLAGS@ $(INCFLAGS) $(WARNFLAGS)
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

SRCS    = Monitor-pthread.C \
	        Mutex-pthread.C \
	        TLSKey-pthread.C \
	        Once-pthread.C \
	        SharedObject-unix.C \
	        NCIO-unix.C \
	        Process.C \
	        Process-unix.C \
            Thread-pthread.C \
	        NetUtils.C \
	        NetUtils-unix.C \
	        PathUtils-unix.C \
	        Error-unix.C

OBJS    = $(SRCS:.C=.o)
DEPS    = $(SRCS:.C=.d)

all: $(TARGET)

$(TARGET): $(TARGET)($(OBJS))
	$(RANLIB) $@

install: $(TARGET)
	for dir in $(libdir) $(includedir) $(includedir)/xplat ; do \
	    if [ ! -d $$dir ] ; then \
	        mkdir -p $$dir ; \
	        chmod 755 $$dir ; \
	    fi \
	done
	if [ ! -x `echo $(INSTALL) | sed 's/ .*$$//'` ] ; then \
	    chmod +x `echo $(INSTALL) | sed 's/ .*$$//'` ; \
	fi
	$(INSTALL) -m 555 $(TARGET) $(libdir)/
	for hdr in @srcdir@/include/xplat/*.h ; do \
	    $(INSTALL) -m 444 $$hdr $(includedir)/xplat/ ; \
	done

clean:
	$(RM) $(OBJS)

distclean: clean
	$(RM) $(TARGET) $(DEPS) config.status config.log config.h Makefile

# pattern rules
@VERBOSEMAKE@
.SUFFIXES:
.SUFFIXES: .c .C .o .d

# TODO this must change - copied from gnu make info files
%.d:    %.C
	set -e; $(CXX) -MM $(CXXFLAGS) $< | \
	    sed 's/\($*\)\.o[ :]*/\1.o $@ : /g' > $@; \
	    [ -s $@ ] || rm -f $@

# make sure file dependencies are determiend and used
include $(DEPS)
