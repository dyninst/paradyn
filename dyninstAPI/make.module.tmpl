# 
# Common makefile template for the dyninstAPI library.  This file is not
# intended to be a useful Makefile in isolation; instead, it should be
# included from within an architecture-specific Makefile.
#
# $Id: make.module.tmpl,v 1.6 1998/04/01 02:23:19 wylie Exp $
#

SUITE_NAME	= DynInst
RELEASE_NUM	= 1.1
#BUILD_MARK should be (re-)defined in core/make.config.local rather than here!

DEFINES		     += -UMT_THREAD \
			-DBPATCH_LIBRARY -DBPATCH_SET_MUTATIONS_ACTIVE

CFLAGS		     += $(TCLFRIENDLYWARNINGS) $(DEFINES)
CXXFLAGS	     += $(TCLFRIENDLYWARNINGS) $(DEFINES)
TFLAGS		     += $(TCLFRIENDLYWARNINGS) $(DEFINES)

TARGET	      = libdyninstAPI.a

VPATH	     += .././.dyninstAPI/src:../dyninstAPI/h:\
		../../paradynd/src:../../paradyn/h

SRCS	     +=	../src/BPatch.C \
		../src/BPatch_image.C \
		../src/BPatch_snippet.C \
		../src/BPatch_templates.C \
		../src/BPatch_thread.C \
		../src/BPatch_type.C \
		../src/BPatch_init.C \
		../src/BPatch_module.C \
		../src/BPatch_point.C \
		../src/dummy.C \
		../src/api_showerror.C \
		../src/ast.C \
		../src/inst.C \
		../src/process.C \
		../src/stats.C \
		../src/symtab.C \
		../src/util.C \
		../src/sharedobject.C \
		../src/templates0.C \
		../src/templates05.C \
		../src/templates1.C

ifdef INCLUDE_PVM_SUPPORT
SRCS	     +=	../../paradynd/src/pvm_support.C \
		../../paradynd/src/host_support.C \
		../../paradynd/src/task_support.C \
		../../paradynd/src/templatesPVM.C

CXXFLAGS	+= -DPARADYND_PVM
LIBS		+= $(PVM_LIB)
endif

ifdef USES_SHM_SAMPLING
SRCS 		+= ../../paradynd/src/fastInferiorHeap.C \
		   ../../paradynd/src/fastInferiorHeapHKs.C \
		   ../../paradynd/src/fastInferiorHeapMgr.C
CXXFLAGS	+= -DSHM_SAMPLING
TFLAGS		+= -DSHM_SAMPLING
CFLAGS		+= -DSHM_SAMPLING
endif

#IGEN_GEN_SRCS = 

#IGEN_ISRCS    = 

LIBS		+= -lpdutil

ifdef CROSSCOMPILER
SYSLIBS		+= -liberty -lg++ -lstdc++ -lm
else
SYSLIBS         += -liberty
endif

IFLAGS       += -I../$(PLATFORM) -I../src -I../h -I../../paradynd/src

all:    $(TARGET)

templates0.o: ../src/templates0.C
	$(CXX) $(TFLAGS) -c ../src/templates0.C

templates05.o: ../src/templates05.C
	$(CXX) $(TFLAGS) -c ../src/templates05.C

templates1.o: ../src/templates1.C
	$(CXX) $(TFLAGS) -c ../src/templates1.C
